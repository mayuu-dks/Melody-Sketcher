(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{2751:(e,t,r)=>{Promise.resolve().then(r.bind(r,3370))},3370:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>ex});var a=r(5155),n=r(2115),o=r(9434);let s=e=>{let{noteName:t,midiNote:r,isBlack:n,isPressed:s,isInScale:i,onMouseDown:l,onMouseUp:c,onTouchStart:d,onTouchEnd:u}=e,m=n?"bg-foreground text-background":"bg-card text-card-foreground",f="ring-border";return i&&!s&&(m=n?"bg-accent/70 text-accent-foreground":"bg-accent/30 text-foreground",f="ring-accent"),s&&(m="bg-primary text-primary-foreground brightness-110",f="ring-primary"),(0,a.jsx)("button",{type:"button",onMouseDown:e=>{e.preventDefault(),l(r)},onMouseUp:e=>{e.preventDefault(),c(r)},onMouseLeave:e=>{e.preventDefault(),s&&c(r)},onTouchStart:e=>{e.preventDefault(),d(r)},onTouchEnd:e=>{e.preventDefault(),u(r)},className:(0,o.cn)("relative flex items-end justify-center select-none h-full shrink-0 ring-1 ring-inset rounded-md","flex-1",m,f,"rounded-md"),"aria-label":t,"data-midi-note":r,children:(0,a.jsx)("span",{className:(0,o.cn)("text-[0.6rem] sm:text-xs pointer-events-none select-none pb-1",s?"text-primary-foreground":i&&n&&!s?"text-accent-foreground":n?"text-background":"text-foreground"),children:t.replace(/[0-9#b]/g,"")})})},i=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],l=e=>{let t=Math.floor(e/12)-1,r=e%12,a=i[r],n=[1,3,6,8,10].includes(r);return{name:"".concat(a).concat(t),isBlack:n,midiNote:e}},c=e=>{let{octaves:t=2,startMidiNote:r=48,onNoteDown:i,onNoteUp:c,notesInScaleFilter:d=[],selectedScaleType:u="Major"}=e,[m,f]=(0,n.useState)(new Set),[h,p]=(0,n.useState)([]),x=function(){let[e,t]=n.useState(void 0);return n.useEffect(()=>{let e=window.matchMedia("(max-width: ".concat(767,"px)")),r=()=>{t(e.matches)};return r(),e.addEventListener?e.addEventListener("change",r):e.addListener(r),()=>{e.removeEventListener?e.removeEventListener("change",r):e.removeListener(r)}},[]),void 0!==e&&e}(),g=function(){let[e,t]=(0,n.useState)(()=>window.innerHeight>=window.innerWidth);return(0,n.useEffect)(()=>{let e=()=>{t(window.innerHeight>=window.innerWidth)};return e(),window.addEventListener("resize",e),window.addEventListener("orientationchange",e),()=>{window.removeEventListener("resize",e),window.removeEventListener("orientationchange",e)}},[]),e}();(0,n.useEffect)(()=>{let e=[],a=Math.floor(12*("Chromatic"===u?1.5:t));if("Chromatic"===u)for(let t=0;t<a;t++){let a=r+t;if(a>127)break;e.push(l(a))}else e=d.filter(e=>e>=r&&e<r+a&&e<=127).map(l).sort((e,t)=>e.midiNote-t.midiNote);p(e)},[t,r,d,u]);let v=(0,n.useCallback)(e=>{i(e),f(t=>new Set(t).add(e))},[i]),y=(0,n.useCallback)(e=>{c(e),f(t=>{let r=new Set(t);return r.delete(e),r})},[c]),b=x&&g&&h.length>=14,N=b?"h-80":"h-40 sm:h-48 md:h-64";if(0===h.length){let e;return"Chromatic"===u?(e="Selected octave range for Chromatic scale is invalid or out of bounds. Try adjusting the octave.",d.length>0&&0===h.length&&(e="No notes from the selected scale lock fall within the current keyboard octave range for Chromatic display. Try adjusting the octave or the scale lock.")):e=0===d.length?"Select a key and scale to see notes, or adjust octave.":"No notes from the selected scale fall within the current keyboard octave range. Try adjusting the octave.",(0,a.jsx)("div",{className:(0,o.cn)("flex justify-center items-center bg-card rounded-lg shadow-inner border border-border p-1",N),children:(0,a.jsx)("p",{className:"text-muted-foreground p-4 text-center",children:e})})}let w=[],j=[];if(b){let e=Math.ceil(h.length/2);w=h.slice(0,e),j=h.slice(e)}else w=h;let k=e=>(0,a.jsx)(s,{noteName:e.name,midiNote:e.midiNote,isBlack:e.isBlack,isPressed:m.has(e.midiNote),isInScale:"Chromatic"!==u||d.includes(e.midiNote),onMouseDown:v,onMouseUp:y,onTouchStart:v,onTouchEnd:y},e.midiNote);return(0,a.jsx)("div",{className:(0,o.cn)("w-full bg-secondary rounded-lg shadow-lg select-none touch-manipulation overflow-hidden border border-foreground/10 p-1",N),role:"application","aria-label":"Virtual Piano Keyboard",children:b?(0,a.jsxs)("div",{className:"flex flex-col h-full w-full gap-1",children:[(0,a.jsx)("div",{className:"relative flex h-1/2 w-full gap-1",children:w.map(k)}),(0,a.jsx)("div",{className:"relative flex h-1/2 w-full gap-1",children:j.map(k)})]}):(0,a.jsx)("div",{className:"relative flex h-full w-full gap-1",children:w.map(k)})})};var d=r(620),u=r(5318),m=r(5222),f=r(7223),h=r(8718),p=r(7053),x=r(1889),g=r(3819),v=r(6931),y=r(8061),b=r(154),N=r(3300),w=r(9708),j=r(2085);let k=(0,j.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),M=n.forwardRef((e,t)=>{let{className:r,variant:n,size:s,asChild:i=!1,...l}=e,c=i?w.DX:"button";return(0,a.jsx)(c,{className:(0,o.cn)(k({variant:n,size:s,className:r})),ref:t,...l})});M.displayName="Button";var C=r(2585),S=r(9556),T=r(7381),E=r(518);let A=C.bL;C.YJ;let R=C.WT,z=n.forwardRef((e,t)=>{let{className:r,children:n,...s}=e;return(0,a.jsxs)(C.l9,{ref:t,className:(0,o.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",r),...s,children:[n,(0,a.jsx)(C.In,{asChild:!0,children:(0,a.jsx)(S.A,{className:"h-4 w-4 opacity-50"})})]})});z.displayName=C.l9.displayName;let D=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)(C.PP,{ref:t,className:(0,o.cn)("flex cursor-default items-center justify-center py-1",r),...n,children:(0,a.jsx)(T.A,{className:"h-4 w-4"})})});D.displayName=C.PP.displayName;let P=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)(C.wn,{ref:t,className:(0,o.cn)("flex cursor-default items-center justify-center py-1",r),...n,children:(0,a.jsx)(S.A,{className:"h-4 w-4"})})});P.displayName=C.wn.displayName;let K=n.forwardRef((e,t)=>{let{className:r,children:n,position:s="popper",...i}=e;return(0,a.jsx)(C.ZL,{children:(0,a.jsxs)(C.UC,{ref:t,className:(0,o.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===s&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",r),position:s,...i,children:[(0,a.jsx)(D,{}),(0,a.jsx)(C.LM,{className:(0,o.cn)("p-1","popper"===s&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:n}),(0,a.jsx)(P,{})]})})});K.displayName=C.UC.displayName,n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)(C.JU,{ref:t,className:(0,o.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",r),...n})}).displayName=C.JU.displayName;let I=n.forwardRef((e,t)=>{let{className:r,children:n,...s}=e;return(0,a.jsxs)(C.q7,{ref:t,className:(0,o.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r),...s,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(C.VF,{children:(0,a.jsx)(E.A,{className:"h-4 w-4"})})}),(0,a.jsx)(C.p4,{children:n})]})});I.displayName=C.q7.displayName,n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)(C.wv,{ref:t,className:(0,o.cn)("-mx-1 my-1 h-px bg-muted",r),...n})}).displayName=C.wv.displayName;let O=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,o.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...n})});O.displayName="Card";let L=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,o.cn)("flex flex-col space-y-1.5 p-6",r),...n})});L.displayName="CardHeader";let _=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,o.cn)("text-2xl font-semibold leading-none tracking-tight",r),...n})});_.displayName="CardTitle",n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,o.cn)("text-sm text-muted-foreground",r),...n})}).displayName="CardDescription";let F=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,o.cn)("p-6 pt-0",r),...n})});F.displayName="CardContent";let U=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,o.cn)("flex items-center p-6 pt-0",r),...n})});U.displayName="CardFooter";var B=r(4073);let V=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsxs)(B.bL,{ref:t,className:(0,o.cn)("relative flex w-full touch-none select-none items-center",r),...n,children:[(0,a.jsx)(B.CC,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:(0,a.jsx)(B.Q6,{className:"absolute h-full bg-primary"})}),(0,a.jsx)(B.zi,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]})});V.displayName=B.bL.displayName;var q=r(968);let G=(0,j.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),X=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)(q.b,{ref:t,className:(0,o.cn)(G(),r),...n})});X.displayName=q.b.displayName;var Y=r(7489);let H=n.forwardRef((e,t)=>{let{className:r,orientation:n="horizontal",decorative:s=!0,...i}=e;return(0,a.jsx)(Y.b,{ref:t,decorative:s,orientation:n,className:(0,o.cn)("shrink-0 bg-border","horizontal"===n?"h-[1px] w-full":"h-full w-[1px]",r),...i})});H.displayName=Y.b.displayName;let W=e=>{let{isRecording:t,onRecordToggle:r,onPlay:n,onExport:o,onClearRecording:s,hasRecording:i,scales:l,keys:c,selectedScale:w,selectedKey:j,onScaleChange:k,onKeyChange:C,audioInitialized:S,onInitializeAudio:T,currentStartOctave:E,onOctaveChange:D,metronomeBpm:P,isMetronomeActive:U,onMetronomeBpmChange:B,onMetronomeToggle:q,onTogglePianoRoll:G,isPianoRollVisible:Y}=e,W=!S||Y&&i;return(0,a.jsxs)(O,{className:"w-full shadow-xl bg-card",children:[(0,a.jsx)(L,{children:(0,a.jsx)(_,{className:"text-xl text-card-foreground",children:"Controls"})}),(0,a.jsxs)(F,{className:"space-y-6",children:[!S&&(0,a.jsxs)(M,{onClick:T,className:"w-full bg-primary hover:bg-primary/90 text-primary-foreground",size:"lg",children:[(0,a.jsx)(d.A,{className:"mr-2 h-5 w-5"})," Initialize Audio & Start"]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-4",children:[(0,a.jsxs)(M,{onClick:G,variant:"outline",className:"w-full","aria-label":Y?"Close Editor":"Edit MIDI",disabled:!S||t||!i&&!Y,children:[Y?(0,a.jsx)(u.A,{className:"mr-1 sm:mr-2 h-4 w-4 sm:h-5 sm:w-5"}):(0,a.jsx)(m.A,{className:"mr-1 sm:mr-2 h-4 w-4 sm:h-5 sm:w-5"}),(0,a.jsx)("span",{className:"text-xs sm:text-sm",children:Y?"Close Edit":"Edit MIDI"})]}),(0,a.jsxs)(M,{onClick:s,disabled:!S||t||!i||Y,variant:"outline",className:"w-full","aria-label":"Clear Recording",children:[(0,a.jsx)(f.A,{className:"mr-1 sm:mr-2 h-4 w-4 sm:h-5 sm:w-5"}),(0,a.jsx)("span",{className:"text-xs sm:text-sm",children:"Clear"})]}),(0,a.jsxs)(M,{onClick:o,disabled:!S||t||!i||Y,variant:"outline",className:"w-full","aria-label":"Export MIDI",children:[(0,a.jsx)(h.A,{className:"mr-1 sm:mr-2 h-4 w-4 sm:h-5 sm:w-5"}),(0,a.jsx)("span",{className:"text-xs sm:text-sm",children:"Export"})]})]}),(0,a.jsx)(H,{}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-4 gap-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(X,{htmlFor:"key-select",className:"block text-sm font-medium text-foreground mb-1",children:"Key"}),(0,a.jsxs)(A,{value:j.name,onValueChange:C,disabled:!S||Y,children:[(0,a.jsxs)(z,{id:"key-select",className:"w-full",children:[(0,a.jsx)(p.A,{className:"mr-2 opacity-70 h-4 w-4"}),(0,a.jsx)(R,{placeholder:"Select Key"})]}),(0,a.jsx)(K,{children:c.map(e=>(0,a.jsx)(I,{value:e.name,children:e.name},e.name))})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(X,{htmlFor:"scale-select",className:"block text-sm font-medium text-foreground mb-1",children:"Scale"}),(0,a.jsxs)(A,{value:w.name,onValueChange:k,disabled:!S||Y,children:[(0,a.jsxs)(z,{id:"scale-select",className:"w-full",children:[(0,a.jsx)(x.A,{className:"mr-2 opacity-70 h-4 w-4"}),(0,a.jsx)(R,{placeholder:"Select Scale"})]}),(0,a.jsx)(K,{children:l.map(e=>(0,a.jsx)(I,{value:e.name,children:e.name},e.name))})]})]}),(0,a.jsxs)("div",{className:"space-y-2 md:col-span-2",children:[(0,a.jsxs)(X,{htmlFor:"octave-slider",className:"text-sm font-medium text-foreground",children:["Start Octave: C",E,Y&&i?" (Piano Roll auto-adjusts)":""]}),(0,a.jsx)(V,{id:"octave-slider",min:0,max:7,step:1,value:[E],onValueChange:D,disabled:W,"aria-label":"Start Octave C".concat(E),className:"mt-1"})]})]}),(0,a.jsx)(H,{}),(0,a.jsxs)("div",{children:[(0,a.jsx)(_,{className:"text-lg text-card-foreground mb-3",children:"Metronome"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-x-4 gap-y-4 items-center",children:[(0,a.jsxs)(M,{onClick:q,variant:U?"secondary":"outline",className:"w-full sm:w-auto","aria-label":U?"Stop Metronome":"Start Metronome",disabled:!S||Y,children:[U?(0,a.jsx)(g.A,{className:"mr-1 sm:mr-2 h-4 w-4 sm:h-5 sm:w-5"}):(0,a.jsx)(v.A,{className:"mr-1 sm:mr-2 h-4 w-4 sm:h-5 sm:w-5"}),(0,a.jsx)("span",{className:"text-xs sm:text-sm",children:U?"Metronome Off":"Metronome On"})]}),(0,a.jsxs)("div",{className:"sm:col-span-2 space-y-2",children:[(0,a.jsxs)(X,{htmlFor:"bpm-slider",className:"text-sm font-medium text-foreground",children:["BPM: ",P]}),(0,a.jsx)(V,{id:"bpm-slider",min:30,max:220,step:1,value:[P],onValueChange:B,disabled:!S||Y,"aria-label":"Metronome BPM ".concat(P),className:"mt-1"})]})]})]}),(0,a.jsx)(H,{}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2 sm:gap-4",children:[(0,a.jsxs)(M,{onClick:r,variant:t?"destructive":"default",className:"w-full","aria-label":t?"Stop Recording":"Start Recording",disabled:!S||Y,children:[t?(0,a.jsx)(y.A,{className:"mr-1 sm:mr-2 h-4 w-4 sm:h-5 sm:w-5"}):(0,a.jsx)(b.A,{className:"mr-1 sm:mr-2 h-4 w-4 sm:h-5 sm:w-5"}),(0,a.jsx)("span",{className:"text-xs sm:text-sm",children:t?"Stop":"Record"})]}),(0,a.jsxs)(M,{onClick:n,disabled:!S||t||!i||Y,className:"w-full","aria-label":"Play Recording",children:[(0,a.jsx)(N.A,{className:"mr-1 sm:mr-2 h-4 w-4 sm:h-5 sm:w-5"}),(0,a.jsx)("span",{className:"text-xs sm:text-sm",children:"Play"})]})]})]})]})};var Q=r(8449),J=r(7655);let Z=n.forwardRef((e,t)=>{let{className:r,children:n,...s}=e;return(0,a.jsxs)(J.bL,{ref:t,className:(0,o.cn)("relative overflow-hidden",r),...s,children:[(0,a.jsx)(J.LM,{className:"h-full w-full rounded-[inherit]",children:n}),(0,a.jsx)($,{}),(0,a.jsx)(J.OK,{})]})});Z.displayName=J.bL.displayName;let $=n.forwardRef((e,t)=>{let{className:r,orientation:n="vertical",...s}=e;return(0,a.jsx)(J.VM,{ref:t,orientation:n,className:(0,o.cn)("flex touch-none select-none transition-colors","vertical"===n&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===n&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",r),...s,children:(0,a.jsx)(J.lr,{className:"relative flex-1 rounded-full bg-border"})})});$.displayName=J.VM.displayName;var ee=r(588);let et="hsl(var(--border))",er=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],ea=e=>{let{initialNotes:t,onNotesChange:r,bpm:s,onClose:i,displayStartOctave:l=2,onPlay:c,onStop:d}=e,[m,h]=(0,n.useState)(t.map(e=>({...e,id:e.id||crypto.randomUUID()}))),[p,x]=(0,n.useState)(new Set),[g,v]=(0,n.useState)(2e4),[b,w]=(0,n.useState)(!1),[j,k]=(0,n.useState)(null),C=(0,n.useRef)(null),[S,T]=(0,n.useState)(null),E=Math.max(24,(l+1)*12),A=Math.min(108,E+36-1),R=(0,n.useRef)(b);(0,n.useEffect)(()=>{R.current=b},[b]),(0,n.useEffect)(()=>{h(t.map(e=>({...e,id:e.id||crypto.randomUUID()}))),0===t.length&&R.current&&q()},[t]);let z=(0,n.useRef)(null);(0,n.useEffect)(()=>(b?null===z.current&&(z.current=ee.oK.scheduleRepeat(e=>{ee.Xm.schedule(()=>{R.current&&k(1e3*ee.oK.seconds)},e)},"60hz")):(null!==z.current&&(ee.oK.clear(z.current),z.current=null),k(null)),()=>{null!==z.current&&(ee.oK.clear(z.current),z.current=null)}),[b]),(0,n.useEffect)(()=>{"started"===ee.oK.state?k(1e3*ee.oK.seconds):k(null)},[]),(0,n.useEffect)(()=>{v(Math.max(2e4,1e3*Math.ceil(m.reduce((e,t)=>Math.max(e,t.startTime+t.duration),0)/1e3)+4e3))},[m]);let D=(e,t,r)=>{let a=6e4/t/(r/4);return Math.max(0,Math.round(e/a)*a)},P=e=>{if(R.current)return;let t=m.map(t=>p.has(t.id)?{...t,startTime:D(t.startTime,s,e)}:t);h(t),r(t.map(e=>({...e,id:e.id})))},K=(e,t,r)=>{let a;if(t.preventDefault(),t.stopPropagation(),R.current)return;let n=e.id;if(t.ctrlKey||t.metaKey?(a=new Set(p)).has(n)?a.delete(n):a.add(n):a=new Set(p.has(n)?p:[n]),x(a),a.size>0){document.body.style.cursor="move"===r?"grabbing":"ew-resize";let e=new Map;m.forEach(t=>{t.id&&a.has(t.id)&&e.set(t.id,{originalStartTime:t.startTime,originalPitch:t.pitch,originalDuration:t.duration})}),T({type:r,noteId:"resize"===r?n:null,startX:t.clientX,startY:t.clientY,originalNotesData:e})}else T(null),document.body.style.cursor="default"},I=(0,n.useCallback)(e=>{if(!S||!S.originalNotesData||0===S.originalNotesData.size)return;let t=e.clientX-S.startX,r=e.clientY-S.startY;h(e=>e.map(e=>{if(!e.id||!S.originalNotesData.has(e.id))return e;let a=S.originalNotesData.get(e.id),n=a.originalStartTime,o=a.originalPitch,s=a.originalDuration;if("move"===S.type){n=Math.max(0,a.originalStartTime+t/.05);let e=Math.round(-r/20);o=Math.max(24,Math.min(108,a.originalPitch+e))}else"resize"===S.type&&S.noteId===e.id&&(s=Math.max(50,a.originalDuration+t/.05));return{...e,startTime:n,pitch:o,duration:s,id:e.id}}))},[S]),B=(0,n.useCallback)(()=>{S&&r(m.map(e=>({...e,id:e.id}))),T(null),document.body.style.cursor="default"},[S,m,r]);(0,n.useEffect)(()=>(S?(document.addEventListener("mousemove",I),document.addEventListener("mouseup",B)):(document.removeEventListener("mousemove",I),document.removeEventListener("mouseup",B)),()=>{document.removeEventListener("mousemove",I),document.removeEventListener("mouseup",B),document.body.style.cursor="default"}),[S,I,B]);let V=async()=>{if(0!==m.length&&!R.current){w(!0);try{let e=m.map(e=>!e||!e.id||isNaN(e.duration)||e.duration<=0||isNaN(e.startTime)||"number"!=typeof e.pitch||isNaN(e.pitch)?(console.warn("Skipping note with invalid values or missing id for playback:",e),null):{...e,id:e.id}).filter(e=>null!==e);if(0===e.length){w(!1);return}await c(e,()=>{w(!1)})}catch(e){console.error("Error during piano roll playback:",e),w(!1)}}},q=()=>{(R.current||"started"===ee.oK.state)&&d()},G=(e,t)=>{if(t.stopPropagation(),R.current)return;let a=m.filter(t=>t.id!==e);h(a),r(a.map(e=>({...e,id:e.id}))),x(t=>{let r=new Set(t);return r.delete(e),r})},X=.05*g,Y=[],H=6e4/s,W=.05*H;for(let e=0;e<=g;e+=H){let t=.05*e,r=e/H%4==0;Y.push((0,a.jsx)("div",{className:"absolute top-0 bottom-0",style:{left:"".concat(t,"px"),width:"1px",backgroundColor:et,opacity:r?.5:.2,pointerEvents:"none"}},"v-".concat(e)));for(let r=1;r<4;r++){let n=t+r*W/4;n<X&&Y.push((0,a.jsx)("div",{className:"absolute top-0 bottom-0",style:{left:"".concat(n,"px"),width:"1px",backgroundColor:et,opacity:.1,pointerEvents:"none"}},"v-sub-".concat(e,"-").concat(r)))}}let J=[];for(let e=0;e<36;e++){let t=[1,3,6,8,10].includes((E+36-1-e)%12);J.push((0,a.jsx)("div",{className:"absolute left-0 right-0",style:{top:"".concat(20*e,"px"),height:"".concat(20,"px"),backgroundColor:t?"hsl(var(--muted) / 0.3)":"transparent",borderBottom:"1px solid ".concat(et),opacity:.2,pointerEvents:"none"}},"h-".concat(e)))}let $=[];for(let e=0;e<36;e++){let t=E+36-1-e;if(t>A||t<E)continue;let r=function(e){if(e<0||e>127)return"";let t=Math.floor(e/12)-1;return er[e%12]+t}(t),n=[1,3,6,8,10].includes(t%12),s=t%12==0;$.push((0,a.jsx)("div",{className:(0,o.cn)("flex items-center justify-end pr-2 text-xs",s?"text-foreground font-semibold":"text-muted-foreground"),style:{height:"".concat(20,"px"),backgroundColor:n?"hsl(var(--muted) / 0.15)":"hsl(var(--card) / 0.1)",borderBottom:"1px solid ".concat(et),opacity:.9},children:r},"pitch-label-".concat(t)))}return(0,a.jsxs)(O,{className:"w-full shadow-xl bg-card flex flex-col h-[600px]",children:[(0,a.jsxs)(L,{className:"flex flex-row items-center justify-between py-3 px-4 border-b",children:[(0,a.jsx)(_,{className:"text-lg text-card-foreground",children:"Piano Roll Editor"}),(0,a.jsx)(M,{variant:"ghost",size:"icon",onClick:()=>{R.current&&q(),i()},"aria-label":"Close Editor",children:(0,a.jsx)(u.A,{className:"h-5 w-5"})})]}),(0,a.jsxs)(F,{className:"p-0 flex-grow flex flex-col overflow-hidden",children:[(0,a.jsxs)("div",{className:"p-2 border-b flex gap-2 items-center flex-wrap",children:[b?(0,a.jsxs)(M,{onClick:q,variant:"destructive",size:"sm",children:[(0,a.jsx)(y.A,{className:"mr-2 h-4 w-4"})," Stop"]}):(0,a.jsxs)(M,{onClick:V,variant:"outline",size:"sm",disabled:0===m.length,children:[(0,a.jsx)(N.A,{className:"mr-2 h-4 w-4"})," Play"]}),(0,a.jsxs)(M,{onClick:()=>{if(R.current)return;let e=m.filter(e=>!p.has(e.id));h(e),r(e.map(e=>({...e,id:e.id}))),x(new Set)},variant:"outline",size:"sm",disabled:0===p.size||R.current,children:[(0,a.jsx)(f.A,{className:"mr-2 h-4 w-4"})," Delete"]}),(0,a.jsxs)(M,{onClick:()=>P(8),variant:"outline",size:"sm",disabled:0===p.size||R.current,children:[(0,a.jsx)(Q.A,{className:"mr-2 h-4 w-4"})," Quantize (8th)"]}),(0,a.jsxs)(M,{onClick:()=>P(16),variant:"outline",size:"sm",disabled:0===p.size||R.current,children:[(0,a.jsx)(Q.A,{className:"mr-2 h-4 w-4"})," Quantize (16th)"]}),(0,a.jsxs)("span",{className:"text-xs text-muted-foreground ml-auto",children:["BPM: ",s]})]}),(0,a.jsx)(Z,{className:"flex-grow relative",children:(0,a.jsxs)("div",{className:"flex h-full",children:[(0,a.jsx)("div",{className:"bg-card border-r border-border shrink-0 sticky top-0 z-10",style:{width:"".concat(45,"px"),height:"".concat(720,"px")},children:$}),(0,a.jsx)("div",{className:"flex-grow overflow-auto",children:(0,a.jsxs)("div",{ref:C,className:"relative select-none bg-background",style:{width:"".concat(X,"px"),height:"".concat(720,"px")},onClick:e=>{let t=e.target,r=!1;for(;t&&t!==C.current&&t!==document.body;){if(t.hasAttribute("data-midi-note-id")){r=!0;break}t=t.parentElement}r||S||x(new Set)},onDoubleClick:e=>{if(!C.current||R.current)return;let t=e.target,a=!1;for(;t&&t!==C.current&&t!==document.body;){if(t.hasAttribute("data-midi-note-id")||t.classList.contains("resize-handle")){a=!0;break}t=t.parentElement}if(a)return;let n=C.current.getBoundingClientRect(),o=e.clientX-n.left+C.current.scrollLeft,i=Math.max(24,Math.min(108,Math.round(E+36-1-(e.clientY-n.top+C.current.scrollTop)/20)));if(i<24||i>108)return;let l=D(o/.05,s,16),c=6e4/s,d=[...m,{id:crypto.randomUUID(),pitch:i,startTime:l,duration:Math.max(50,c/4),velocity:100}].sort((e,t)=>e.startTime-t.startTime);h(d),r(d.map(e=>({...e,id:e.id})))},children:[J,Y,m.map(e=>{if(!e||!e.id)return null;let t=(E+36-1-e.pitch)*20,r=.05*e.startTime,n=.05*e.duration;if(e.pitch<E||e.pitch>A||t<0||t>=720||r>X+100)return null;let s=p.has(e.id);return(0,a.jsx)("div",{"data-midi-note-id":e.id,className:(0,o.cn)("absolute rounded-sm cursor-grab active:cursor-grabbing flex items-center justify-end",s?"border-2 border-accent-foreground shadow-md z-10":"ring-1 ring-foreground/20"),style:{left:"".concat(r,"px"),top:"".concat(t,"px"),width:"".concat(Math.max(n,5),"px"),height:"".concat(18,"px"),backgroundColor:s?"hsl(var(--accent))":"hsl(var(--primary))",opacity:s?1:e.velocity?e.velocity/127*.6+.4:1,marginTop:"1px"},onMouseDown:t=>K(e,t,"move"),onDoubleClick:t=>G(e.id,t),children:(0,a.jsx)("div",{className:"absolute top-0 right-0 bottom-0 w-2 cursor-ew-resize hover:bg-white/30 resize-handle",style:{zIndex:1},onMouseDown:t=>K(e,t,"resize")})},e.id)}),null!==j&&(0,a.jsx)("div",{className:"absolute top-0 bottom-0 w-0.5 bg-accent z-20",style:{left:"".concat(.05*j,"px"),pointerEvents:"none"}})]})})]})})]}),(0,a.jsxs)(U,{className:"p-2 border-t text-xs text-muted-foreground",children:[p.size>0?"".concat(p.size," note(s) selected."):"Click notes to select. Ctrl/Cmd + Click for multi-select. Double-click grid to add, note to delete.",R.current&&(0,a.jsx)("span",{className:"ml-auto text-primary font-semibold",children:"Playing..."})]})]})},en=[77,84,104,100],eo=[0,0,0,6],es=[0,0],ei=[0,1],el=[77,84,114,107],ec=[255,47,0];function ed(e){if(0===e)return[0];let t=e,r=[];for(r.push(127&t),t>>=7;t>0;)r.push(127&t|128),t>>=7;return r.reverse()}let eu=[{name:"Major",intervals:[0,2,4,5,7,9,11]},{name:"Minor (Natural)",intervals:[0,2,3,5,7,8,10]},{name:"Minor (Harmonic)",intervals:[0,2,3,5,7,8,11]},{name:"Minor (Melodic)",intervals:[0,2,3,5,7,9,11]},{name:"Dorian",intervals:[0,2,3,5,7,9,10]},{name:"Phrygian",intervals:[0,1,3,5,7,8,10]},{name:"Lydian",intervals:[0,2,4,6,7,9,11]},{name:"Mixolydian",intervals:[0,2,4,5,7,9,10]},{name:"Locrian",intervals:[0,1,3,5,6,8,10]},{name:"Pentatonic Major",intervals:[0,2,4,7,9]},{name:"Pentatonic Minor",intervals:[0,3,5,7,10]},{name:"Blues",intervals:[0,3,5,6,7,10]},{name:"Whole Tone",intervals:[0,2,4,6,8,10]},{name:"Diminished (Half-Whole)",intervals:[0,1,3,4,6,7,9,10]},{name:"Lydian Dominant",intervals:[0,2,4,6,7,9,10]},{name:"Chromatic",intervals:[0,1,2,3,4,5,6,7,8,9,10,11]}],em=[{name:"C",rootMidiNote:48},{name:"C# / Db",rootMidiNote:49},{name:"D",rootMidiNote:50},{name:"D# / Eb",rootMidiNote:51},{name:"E",rootMidiNote:52},{name:"F",rootMidiNote:53},{name:"F# / Gb",rootMidiNote:54},{name:"G",rootMidiNote:55},{name:"G# / Ab",rootMidiNote:56},{name:"A",rootMidiNote:57},{name:"A# / Bb",rootMidiNote:58},{name:"B",rootMidiNote:59}],ef=eu.find(e=>"Major"===e.name),eh=em.find(e=>"C"===e.name);var ep=r(7481);function ex(){let{toast:e}=(0,ep.dj)(),{playNote:t,stopNote:r,startRecording:o,stopRecording:s,playback:i,stopPlayback:l,isRecording:d,recordedNotes:u,setRecordedNotes:m,clearRecording:f,startMetronome:h,stopMetronome:p}=function(){let{onNotePlayed:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,n.useRef)(null),r=(0,n.useRef)(new Map),[a,o]=(0,n.useState)([]),[s,i]=(0,n.useState)(!1),l=(0,n.useRef)(null),c=(0,n.useRef)(null),d=(0,n.useRef)(null),u=(0,n.useRef)(null),m=(0,n.useRef)(null),f=(0,n.useRef)(null);(0,n.useEffect)(()=>{try{t.current=new ee.Bh(ee.RG,{oscillator:{type:"triangle"},envelope:{attack:.02,decay:.1,sustain:.3,release:.5}}).toDestination(),c.current=new ee.RG({oscillator:{type:"sine"},envelope:{attack:.001,decay:.05,sustain:0,release:.05},volume:-10}).toDestination(),120!==ee.oK.bpm.value&&(ee.oK.bpm.value=120),u.current=new ee.eS((e,r)=>{if(!t.current||!r||"number"!=typeof r.pitch||isNaN(r.pitch)||"number"!=typeof r.duration||isNaN(r.duration)||r.duration<=0){console.warn("Playback: Skipping invalid note event",r);return}try{let a=ee.jN(r.pitch,"midi").toFrequency();if(isNaN(a)){console.error("Playback: Calculated frequency is NaN for pitch",r.pitch);return}let n=(r.velocity||100)/127;t.current.triggerAttackRelease(a,r.duration,e,n)}catch(e){console.error("Error in playback part callback:",e,r)}},[]),u.current.loop=!1}catch(e){console.error("Error initializing Tone.js components in useMidiPlayer useEffect:",e)}return()=>{var e,r;if(null===(e=t.current)||void 0===e||e.dispose(),null===(r=c.current)||void 0===r||r.dispose(),u.current&&u.current.dispose(),null!==d.current&&ee.oK.clear(d.current),null!==f.current&&ee.oK.off("stop",f.current),"started"===ee.oK.state)try{ee.oK.stop(),ee.oK.cancel(0)}catch(e){}}},[]);let h=(0,n.useCallback)(function(a){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;if(console.log("playNote called. Pitch: ".concat(a,", Tone.context.state: ").concat(ee._O.state)),"number"!=typeof a||isNaN(a)){console.error("playNote called with invalid pitch:",a);return}if(!t.current){console.warn("playNote: Synth not initialized.");return}if("running"!==ee._O.state){console.warn("playNote: AudioContext not running. Please initialize audio by clicking the 'Initialize Audio' button.");return}try{let o=ee.jN(a,"midi").toFrequency();if(isNaN(o)){console.error("playNote: Calculated frequency is NaN for pitch ".concat(a));return}if(t.current.triggerAttack(o,ee.tB(),n/127),s&&null!==l.current&&!r.current.has(a)){let e=performance.now()-l.current;r.current.set(a,{startTime:e})}null==e||e(a,n)}catch(e){console.error("Error in playNote triggerAttack:",e,{pitch:a,velocity:n})}},[s,e]),p=(0,n.useCallback)(e=>{if("number"!=typeof e||isNaN(e)){console.error("stopNote called with invalid pitch:",e);return}if(!t.current){console.warn("stopNote: Synth not initialized.");return}if("running"===ee._O.state)try{let a=ee.jN(e,"midi").toFrequency();if(isNaN(a)){console.error("stopNote: Calculated frequency is NaN for pitch ".concat(e));return}if(t.current.triggerRelease(a,ee.tB()),s&&null!==l.current&&r.current.has(e)){let t=r.current.get(e),a=performance.now()-l.current-t.startTime,n=crypto.randomUUID();a>50&&o(r=>[...r,{id:n,pitch:e,startTime:t.startTime,duration:a,velocity:100}].sort((e,t)=>e.startTime-t.startTime)),r.current.delete(e)}}catch(t){console.error("Error in stopNote triggerRelease:",t,{pitch:e})}},[s]),x=(0,n.useCallback)(async()=>{if("running"!==ee._O.state){console.warn("Cannot start recording: AudioContext not running. Please initialize audio.");return}i(!0),o([]),r.current.clear(),l.current=performance.now()},[]),g=(0,n.useCallback)(()=>{if(i(!1),null!==l.current){let e=performance.now(),t=[];r.current.forEach((r,a)=>{let{startTime:n}=r,o=e-l.current-n;if(o>50){let e=crypto.randomUUID();t.push({id:e,pitch:a,startTime:n,duration:o,velocity:100})}}),r.current.clear(),t.length>0&&o(e=>[...e,...t].sort((e,t)=>e.startTime-t.startTime))}l.current=null},[]),v=(0,n.useCallback)(async(e,r)=>{let n=(e||a).filter(e=>e&&"string"==typeof e.id&&"number"==typeof e.pitch&&!isNaN(e.pitch)&&"number"==typeof e.startTime&&!isNaN(e.startTime)&&"number"==typeof e.duration&&!isNaN(e.duration)&&e.duration>0);if(!t.current||!u.current){console.warn("Playback: Synth or PlaybackPart not initialized."),r&&setTimeout(r,10);return}if(0===n.length){console.log("Playback: No valid notes to play."),r&&setTimeout(r,10);return}if("running"!==ee._O.state){console.warn("Playback: AudioContext not running. Attempting to start.");try{await ee.ni(),console.log("Playback: Tone.start() successful.")}catch(e){console.error("Playback: Failed to start audio context for playback:",e),r&&setTimeout(r,10);return}}"started"===ee.oK.state&&ee.oK.stop(),ee.oK.cancel(0),u.current.clear();let o=0;n.forEach(e=>{let t=Math.max(.01,e.duration/1e3),r=e.startTime/1e3;u.current.add(r,{...e,duration:t}),o=Math.max(o,r+t)}),u.current.loop=!1,ee.oK.position=0,null!==f.current&&(ee.oK.off("stop",f.current),f.current=null),m.current&&(m.current=null);let s=Math.max(.05,o+.1);ee.oK.scheduleOnce(()=>{"started"===ee.oK.state&&ee.oK.stop()},s),r&&(m.current=r,f.current=ee.oK.on("stop",()=>{m.current&&(m.current(),m.current=null),null!==f.current&&(ee.oK.off("stop",f.current),f.current=null)})),console.log("Playback: Starting transport and part."),ee.oK.start(ee.tB()+.05),u.current.start(0)},[a]),y=(0,n.useCallback)(()=>{var e,r;console.log("stopPlayback called. Tone.Transport.state:",ee.oK.state),"started"===ee.oK.state?ee.oK.stop():(m.current&&(m.current(),m.current=null),null!==f.current&&(ee.oK.off("stop",f.current),f.current=null)),null===(e=u.current)||void 0===e||e.clear(),null===(r=t.current)||void 0===r||r.releaseAll(ee.tB())},[]),b=(0,n.useCallback)(()=>{o([])},[]);return{playNote:h,stopNote:p,startRecording:x,stopRecording:g,playback:v,stopPlayback:y,isRecording:s,recordedNotes:a,setRecordedNotes:o,clearRecording:b,startMetronome:(0,n.useCallback)(async e=>{if(!c.current){console.warn("Metronome synth not initialized.");return}if("running"!==ee._O.state){console.warn("Metronome: AudioContext not running. Attempting to start.");try{await ee.ni(),console.log("Metronome: Tone.start() successful.")}catch(e){console.error("Metronome: Failed to start audio context for metronome:",e);return}}if(ee.oK.bpm.value=e,null!==d.current&&ee.oK.clear(d.current),"started"!==ee.oK.state){var t;null===(t=u.current)||void 0===t||t.clear()}d.current=ee.oK.scheduleRepeat(e=>{if(c.current&&"running"===ee._O.state){var t;null===(t=c.current)||void 0===t||t.triggerAttackRelease("C6","32n",e)}},"4n"),"started"!==ee.oK.state&&(console.log("Metronome: Starting transport for metronome."),ee.oK.start())},[]),stopMetronome:(0,n.useCallback)(()=>{null!==d.current&&(ee.oK.clear(d.current),d.current=null,console.log("Metronome stopped and schedule cleared."))},[])}}(),[x,g]=(0,n.useState)(eh),[v,y]=(0,n.useState)(ef),[b,N]=(0,n.useState)([]),[w,j]=(0,n.useState)(!1),[k,M]=(0,n.useState)(Math.floor(eh.rootMidiNote/12)-1),[C,S]=(0,n.useState)((Math.floor(eh.rootMidiNote/12)-1+1)*12+eh.rootMidiNote%12),[T,E]=(0,n.useState)(3),[A,R]=(0,n.useState)(120),[z,D]=(0,n.useState)(!1),[P,K]=(0,n.useState)(!1),[I,O]=(0,n.useState)(!1);(0,n.useEffect)(()=>{O(!0)},[]),(0,n.useEffect)(()=>{N(function(e,t){let r=[],a=e.rootMidiNote%12;for(let e=0;e<10;e++)t.intervals.forEach(t=>{let n=a+t+12*e;n<=127&&r.push(n)});return[...new Set(r)].sort((e,t)=>e-t)}(x,v))},[x,v]),(0,n.useEffect)(()=>(z&&w?h(A):p(),()=>{p()}),[z,A,w,h,p]),(0,n.useEffect)(()=>{let e=k;if(P&&u.length>0){let t=u.map(e=>e.pitch),r=Math.min(...t);e=Math.max(0,Math.min(6,Math.floor(Math.max(0,Math.min((r+Math.max(...t))/2-18,r-6))/12)))}E(e)},[u,P,k]);let L=async()=>{if(console.log("Attempting to ensure audio context is started..."),"running"!==ee._O.state)try{if(console.log("Tone.context.state before Tone.start():",ee._O.state),await ee.ni(),console.log("Tone.start() resolved. Tone.context.state after Tone.start():",ee._O.state),"running"===ee._O.state){console.log("Audio context is running. Priming audio...");let e=new ee.vq({frequency:0,volume:-100,type:"sine"}).toDestination(),t=ee.tB();e.start(t),e.stop(t+.1),e.onstop=()=>{e.disposed||(console.log("Priming oscillator stopped and disposing."),e.dispose())}}else console.warn("Tone.start() resolved, but context is still not running:",ee._O.state)}catch(e){throw console.error("ensureAudioContextStartedAndPrime: Failed to start or prime Tone.js AudioContext",e),e}else console.log("Audio context already running.")},_=(0,n.useCallback)(async()=>{if(!w)try{await L(),"running"===ee._O.state?(j(!0),e({title:"Audio Initialized",description:"Melody Sketcher is ready!"}),console.log("Audio context successfully initialized and primed.")):(e({title:"Audio Not Started",description:"Audio context did not start. Try interacting with the page or check browser permissions.",variant:"destructive"}),console.error("Audio context failed to start or remain running after ensureAudioContextStartedAndPrime."))}catch(t){e({title:"Audio Error",description:"Could not initialize audio. Please try again or check browser permissions.",variant:"destructive"}),console.error("Failed to initialize audio context in handleInitializeAudio:",t)}},[w,e]),F=async()=>{if(!w){e({title:"Audio Not Ready",description:"Please initialize audio first.",variant:"destructive"});return}if(0===u.length){e({title:"Nothing to Play",description:"Record some notes first."});return}e({title:"Playing Recording..."}),await i()},U=(0,n.useCallback)(e=>{w&&t(e,100)},[w,t]),B=(0,n.useCallback)(e=>{w&&r(e)},[w,r]),V=()=>{if(0===u.length&&!P){e({title:"No MIDI to Edit",description:"Record some notes first before opening the editor."});return}P&&"started"===ee.oK.state&&l(),K(e=>!e)},q=async(t,r)=>{if(!w){e({title:"Audio Not Ready",description:"Please initialize audio first.",variant:"destructive"}),r&&setTimeout(r,10);return}if(0===t.length){e({title:"Nothing to Play",description:"No notes in editor."}),r&&setTimeout(r,10);return}await i(t,r)},G="Chromatic"===v.name?1.5:2;return(0,a.jsxs)("div",{className:"min-h-screen bg-background text-foreground flex flex-col items-center p-2 sm:p-4 md:p-8 space-y-4 md:space-y-6",children:[(0,a.jsxs)("header",{className:"text-center mt-4 sm:mt-0",children:[(0,a.jsx)("h1",{className:"text-3xl sm:text-4xl md:text-5xl font-bold text-primary",children:"Melody Sketcher"}),(0,a.jsx)("p",{className:"text-muted-foreground text-sm sm:text-base mt-1 sm:mt-2",children:"Craft your melodies. Record. Edit. Export."})]}),(0,a.jsx)("main",{className:"w-full max-w-5xl xl:max-w-7xl space-y-4 md:space-y-6",children:I?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(W,{isRecording:d,onRecordToggle:()=>{if(!w){e({title:"Audio Not Ready",description:"Please initialize audio first by clicking the 'Initialize Audio' button.",variant:"destructive"});return}d?(s(),e({title:"Recording Stopped"})):(o(),e({title:"Recording Started"}))},onPlay:F,onExport:()=>{if(0===u.length){e({title:"Nothing to Export",description:"Record some notes first."});return}try{let t=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:96,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:120,a=[],n=0,o=[...e].sort((e,t)=>e.startTime!==t.startTime?e.startTime-t.startTime:e.pitch-t.pitch),s=r/60*t/1e3,i=[];o.forEach(e=>{let t=Math.round(e.startTime*s),r=Math.round(e.duration*s),a=e.velocity||100;i.push({timeTicks:t,type:"on",pitch:e.pitch,velocity:a}),i.push({timeTicks:t+r,type:"off",pitch:e.pitch,velocity:0})}),i.sort((e,t)=>e.timeTicks-t.timeTicks),i.forEach(e=>{let t=e.timeTicks-n;a.push(...ed(t)),"on"===e.type?a.push(144,e.pitch,e.velocity):a.push(128,e.pitch,e.velocity),n=e.timeTicks}),a.push(...ed(0)),a.push(...ec);let l=a.length;return new Uint8Array([...en,...eo,...es,...ei,t>>8&255,255&t,...el,l>>24&255,l>>16&255,l>>8&255,255&l,...a])}(u,void 0,A),r=new Blob([t],{type:"audio/midi"}),a=URL.createObjectURL(r),n=document.createElement("a");n.href=a,n.download="melody-sketch-".concat(new Date().toISOString().slice(0,10),".mid"),document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(a),e({title:"MIDI Exported",description:"Check your downloads folder."})}catch(t){console.error("MIDI Export failed:",t),e({title:"Export Failed",description:"Could not generate MIDI file. See console for details.",variant:"destructive"})}},onClearRecording:()=>{f(),e({title:"Recording Cleared"})},hasRecording:u.length>0,scales:eu,keys:em,selectedScale:v,selectedKey:x,onScaleChange:e=>{y(eu.find(t=>t.name===e)||ef)},onKeyChange:e=>{let t=em.find(t=>t.name===e)||eh;g(t),S((k+1)*12+t.rootMidiNote%12)},audioInitialized:w,onInitializeAudio:_,currentStartOctave:k,onOctaveChange:e=>{let t=e[0];M(t),S((t+1)*12+x.rootMidiNote%12)},metronomeBpm:A,isMetronomeActive:z,onMetronomeBpmChange:e=>{R(e[0])},onMetronomeToggle:()=>{if(!w){e({title:"Audio Not Ready",description:"Please initialize audio first.",variant:"destructive"});return}D(e=>!e)},onTogglePianoRoll:V,isPianoRollVisible:P}),P?(0,a.jsx)(ea,{initialNotes:u,onNotesChange:e=>{m(e)},bpm:A,onClose:V,displayStartOctave:T,onPlay:q,onStop:l}):(0,a.jsx)(c,{octaves:G,startMidiNote:C,onNoteDown:U,onNoteUp:B,notesInScaleFilter:b,selectedScaleType:v.name})]}):(0,a.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,a.jsx)("p",{className:"text-muted-foreground",children:"Loading Melody Sketcher..."})})}),(0,a.jsx)("footer",{className:"text-center text-xs text-muted-foreground py-4",children:(0,a.jsxs)("p",{children:["\xa9 ",new Date().getFullYear()," Melody Sketcher. Create something amazing!"]})})]})}},7481:(e,t,r)=>{"use strict";r.d(t,{dj:()=>m});var a=r(2115);let n=0,o=new Map,s=e=>{if(o.has(e))return;let t=setTimeout(()=>{o.delete(e),d({type:"REMOVE_TOAST",toastId:e})},1e6);o.set(e,t)},i=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:r}=t;return r?s(r):e.toasts.forEach(e=>{s(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===r||void 0===r?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},l=[],c={toasts:[]};function d(e){c=i(c,e),l.forEach(e=>{e(c)})}function u(e){let{...t}=e,r=(n=(n+1)%Number.MAX_SAFE_INTEGER).toString(),a=()=>d({type:"DISMISS_TOAST",toastId:r});return d({type:"ADD_TOAST",toast:{...t,id:r,open:!0,onOpenChange:e=>{e||a()}}}),{id:r,dismiss:a,update:e=>d({type:"UPDATE_TOAST",toast:{...e,id:r}})}}function m(){let[e,t]=a.useState(c);return a.useEffect(()=>(l.push(t),()=>{let e=l.indexOf(t);e>-1&&l.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>d({type:"DISMISS_TOAST",toastId:e})}}},9434:(e,t,r)=>{"use strict";r.d(t,{cn:()=>o});var a=r(2596),n=r(9688);function o(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,n.QP)((0,a.$)(t))}}},e=>{var t=t=>e(e.s=t);e.O(0,[774,375,441,684,358],()=>t(2751)),_N_E=e.O()}]);